<!DOCTYPE html>
<html>

<head>
    <title>Vector Initial Static Map</title>
    <script src="https://polyfill.io/v3/polyfill.min.js?features=default"></script>
    <script
        src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAVuTX2xVdm8OScLSE8kVWr-jP4L2582mw&callback=initMap&v=beta"
       async defer>
    </script>

     <script>


        (function (exports) 
        {

        var map;
        var infoWindow;
        
      
            function initMap() {
                displayMap();
            }

            function displayMap() {
              map = new google.maps.Map(document.getElementById("map"), {
                    center: { lat: 51.503399, lng:  -0.119519 },
                    zoom: 17,
                    heading: 320,
                    tilt:50,
                    mapId: "7c913e398bf72d2d",
                    disableDefaultUI: true,
                    
                });

                setInterval(getLocation,1000)
               getDirection()
            }

            function getLocation(){
            
                    if (navigator.geolocation) {
                    navigator.geolocation.getCurrentPosition(
                        (position) => {
                        const pos = {
                            lat: position.coords.latitude,
                            lng: position.coords.longitude,
                        };

                        console.log(pos)
                        
                        var marker = new google.maps.Marker({position:pos
                        });
                        marker.setMap(map);
                       
                        map.setCenter(pos);
                        },
                        () => {
                        handleLocationError(true, infoWindow, map.getCenter());
                        },
                    );
                    } else {
                    // Browser doesn't support Geolocation
                    handleLocationError(false, infoWindow, map.getCenter());
                    }
                
            }

            function handleLocationError(browserHasGeolocation, infoWindow, pos) {
                infoWindow.setPosition(pos);
                infoWindow.setContent(
                    browserHasGeolocation
                    ? "Error: The Geolocation service failed."
                    : "Error: Your browser doesn't support geolocation.",
                );
                infoWindow.open(map);
            }

            function getDirection(){
                const directionsRenderer = new google.maps.DirectionsRenderer();
                const directionsService = new google.maps.DirectionsService();
                directionsRenderer.setMap(map);
            
                const start = "Royal enfield HQ, Sholinganallur,chennai";
                const end = "BSR Mall, Chennai";

                directionsService
                    .route({
                    origin: start,
                    destination: end,
                    travelMode: google.maps.TravelMode.DRIVING,
                    })
                    .then((response) => {
                        console.log(response.routes[0].legs[0].steps)
                    directionsRenderer.setDirections(response);

                    for(var i = 0; i<response.routes[0].legs[0].steps.length; i++){

                        var marker = new google.maps.Marker({position:response.routes[0].legs[0].steps[i].end_location});
                        marker.setMap(map);
                   
                     }


                    })
                .catch((e) => window.alert("Directions request failed due to " + status));


            }

        exports.initMap = initMap;
        }
    )((this.window = this.window || {}));

    </script>

    <style>
            html,
            body,
            .container {
                height: 100%;
            }
    
            .container {
                display: flex;
                flex-wrap: wrap;
                margin: 0;
            }
    
            .map {
                display: flex;
                flex-direction: column;
                flex-basis: 100%;
                flex: 1;
                height: 100%;
            }
    </style>
</head>
    
    <body>
        <div class="container">
            <div id="map" class="map"></div>
        </div>
    </body>
    
</html>